'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},serverStorage=Redux.createStore(editServerStore),connectionStorage=Redux.createStore(editConnStore),adminpanelStorage=Redux.createStore(editAdmpanelStore,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());function editServerStore(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{users:{},admins:{},tasks:{}},f=arguments[1];try{switch(f.type){case'SYNC_OBJECT':var a=f.payload;return a;break;case'CLEAR_STORAGE':var a={users:{},admins:{},tasks:{}};return a;break;default:}}catch(g){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0430:'+g)}return b}function editConnStore(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{uids:{},users:{}},f=arguments[1];try{switch(f.type){case'SYNC_OBJECT':var a=f.payload;return a;break;case'CLEAR_STORAGE':var a={uids:{},users:{}};return a;break;default:}}catch(g){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0430 \u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0439:'+g)}return b}function editAdmpanelStore(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{auth:!1,report:{},reportsort:{},reportsortvalid:!1,groups:{}},f=arguments[1];try{switch(f.type){case'AUTH':var a=_.clone(b);return a.auth=f.payload.auth,a;break;case'GEN_REPORT':var a=_.clone(b);return a.report=f.payload.report,a.reportsort=f.payload.reportsort,a.reportsortvalid=f.payload.reportsortvalid,a;break;case'GEN_GROUP':var a=_.clone(b);return a.groups=f.payload.groups,a;break;default:}}catch(g){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0430 \u0430\u0434\u043C\u0438\u043D\u043F\u0430\u043D\u0435\u043B\u0438:'+g)}return b}serverStorage.subscribe(function(){GenerateReport(),GenerateGroup()});function login(a,b,f){try{'object'===('undefined'==typeof a?'undefined':_typeof(a))&&a.emit('login',{user:b,password:f})}catch(g){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0432 \u0441\u043E\u043A\u0435\u0442\u0435:'+g)}}function datetime(){try{var a=new Date;return'['+a.getDate()+'.'+(a.getMonth()+1)+'.'+a.getFullYear()+' - '+a.getHours()+'.'+a.getMinutes()+'.'+a.getSeconds()+'] '}catch(b){console.log('\u041F\u0440\u043E\u0431\u043B\u0435\u043C\u0430 \u0441 \u0444\u0443\u043D\u043A\u0446\u0438\u0435\u0439 datetime()!')}}function timeStamp(a){try{var b;return b=9<a.getDate()?a.getDate()+'.':'0'+a.getDate()+'.',b=9<a.getMonth()+1?b+(a.getMonth()+1)+'.'+a.getFullYear()+' ':b+'0'+(a.getMonth()+1)+'.'+a.getFullYear()+' ',b=9<a.getHours()?b+a.getHours()+':':b+'0'+a.getHours()+':',b=9<a.getMinutes()?b+a.getMinutes()+':':b+'0'+a.getMinutes()+':',9<a.getSeconds()?b+=a.getSeconds():b=b+'0'+a.getSeconds(),b}catch(f){return'00.00.0000 00:00:00'}}function generateUID(){try{var a=new Date().getTime();return'undefined'!=typeof performance&&'function'==typeof performance.now&&(a+=performance.now()),'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(b){var f=0|(a+16*Math.random())%16;return a=Math.floor(a/16),('x'===b?f:8|3&f).toString(16)})}catch(b){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u0438 uid!')}}function listenSocket(a){try{a.on('sendServerStorageToAdmin',function(b){try{serverStorage.dispatch({type:'SYNC_OBJECT',payload:b})}catch(f){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0430 \u0434\u0430\u043D\u043D\u044B\u0445: '+f)}}),a.on('sendConnStorageToAdmin',function(b){try{connectionStorage.dispatch({type:'SYNC_OBJECT',payload:b})}catch(f){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0430 \u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0439: '+f)}}),a.on('disconnect',function(){try{serverStorage.dispatch({type:'CLEAR_STORAGE'}),connectionStorage.dispatch({type:'CLEAR_STORAGE'}),console.log(datetime()+'\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0440\u0430\u0437\u043E\u0440\u0432\u0430\u043D\u043E!')}catch(b){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0447\u0438\u0441\u0442\u043A\u0438 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449, \u043F\u0440\u0438 \u0440\u0430\u0437\u0440\u044B\u0432\u0435 \u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u044F: '+b)}})}catch(b){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u043E\u0441\u043B\u0443\u0448\u0438\u0432\u0430\u043D\u0438\u044F \u0441\u043E\u043A\u0435\u0442\u0430: '+b)}}function initialiseSocket(a,b){try{var f='{"protocol":"https","server":"'+window.location.hostname+'","port":"444","login":"'+a+'","password":"'+b+'"}',g;try{g=JSON.parse(f)}catch(n){console.log(datetime()+'\u041D\u0435 \u043C\u043E\u0433\u0443 \u0440\u0430\u0441\u043F\u0430\u0440\u0441\u0438\u0442\u044C \u0441\u0442\u0440\u043E\u043A\u0443 \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438!')}if('object'===('undefined'==typeof g?'undefined':_typeof(g))){var h=g.login,b=CryptoJS.SHA256(h+g.password+'icommander').toString();'undefined'!=typeof m&&m.close();var j=g.protocol,k=g.server,l=g.port,m=io(j+'://'+k+':'+l);window.socket=m;do'undefined'!=typeof m&&(m.on('connect',function(){console.log(datetime()+'\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043E!')}),m.on('initialize',function(n){'whois'===n.value&&login(m,h,b)}),m.on('authorisation',function(n){'true'===n.value?(console.log(datetime()+'\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F \u043F\u0440\u043E\u0439\u0434\u0435\u043D\u0430!'),adminpanelStorage.dispatch({type:'AUTH',payload:{auth:!0}})):(serverStorage.dispatch({type:'CLEAR_STORAGE'}),connectionStorage.dispatch({type:'CLEAR_STORAGE'}),console.log(datetime()+'\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F \u043D\u0435 \u043F\u0440\u043E\u0439\u0434\u0435\u043D\u0430!'),adminpanelStorage.dispatch({type:'AUTH',payload:{auth:!1}}))}),listenSocket(m));while('undefined'==typeof m)}else console.log(datetime()+'\u041D\u0435 \u043C\u043E\u0433\u0443 \u0440\u0430\u0441\u043F\u043E\u0437\u043D\u0430\u0442\u044C \u043E\u0431\u044A\u0435\u043A\u0442 \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438!')}catch(n){console.log(datetime()+'\u041A\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u0430!')}}function replacer(a,b){try{return _typeof('string'===a)?b?a.replace(/\./gi,'_'):a.replace(/\_/gi,'.'):'(\u043D\u0435 \u043C\u043E\u0433\u0443 \u043F\u0440\u0435\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u0442\u044C, \u0442.\u043A. \u0442\u0438\u043F \u0432\u0445\u043E\u0434\u044F\u0449\u0435\u0433\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u0430 \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0441\u0442\u0440\u043E\u043A\u043E\u0432\u044B\u043C)'}catch(f){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0435\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u043D\u0438\u044F \u0438\u043C\u0435\u043D\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F!')}}function GenerateReport(){try{var a=serverStorage.getState().tasks,b={},f={};for(var g in a)try{for(var h in a[g])try{'undefined'==typeof b[h]&&(b[h]={complete:[],incomplete:[],objects:{}}),'true'===a[g][h].complete?b[h].complete.push(g):b[h].incomplete.push(g),'undefined'==typeof b[h].objects[g]&&(b[h].objects[g]={}),'undefined'!=typeof a[g][h].datetime&&(b[h].objects[g].datetime=a[g][h].datetime),'undefined'!=typeof a[g][h].timeoncompl&&(b[h].objects[g].datetimeout=new Date(a[g][h].timeoncompl).getTime()),'undefined'!=typeof a[g][h].tryval&&(b[h].objects[g].tryval=a[g][h].tryval),'undefined'!=typeof a[g][h].datetimecompl&&(b[h].objects[g].datetimecompl=a[g][h].datetimecompl),'undefined'!=typeof a[g][h].complete&&(b[h].objects[g].complete=a[g][h].complete),'undefined'!=typeof a[g][h].answer&&(b[h].objects[g].answer=a[g][h].answer),'undefined'!=typeof a[g][h].datetime&&(b[h].datetime=a[g][h].datetime),'undefined'!=typeof a[g][h].comment&&(b[h].comment=a[g][h].comment)}catch(q){console.log(datetime()+'\u041D\u0435 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u0430\u043D \u0442\u0430\u0441\u043A '+h+' \u0434\u043B\u044F '+g+' \u043F\u0440\u0438 \u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u0438 \u043E\u0442\u0447\u0435\u0442\u0430!')}var j=0,k=0,l=!1;f={};var m={},n=[];for(var h in b)m[b[h].datetime]=h,n.push(b[h].datetime),j++;n=n.sort();for(var o=n.length-1;-1<o;o--)f[n[o]]=m[n[o]];for(var p in f)k++;j==k&&(l=!0)}catch(q){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u0438 \u043E\u0442\u0447\u0435\u0442\u0430 \u043F\u043E \u0442\u0430\u0441\u043A\u0430\u043C \u0434\u043B\u044F '+g+'!')}adminpanelStorage.dispatch({type:'GEN_REPORT',payload:{report:b,reportsort:f,reportsortvalid:l}})}catch(q){console.log(datetime()+'\u041E\u0448\u0438\u0431\u043A\u0430 \u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u0438 \u043E\u0442\u0447\u0435\u0442\u043E\u0432 \u043F\u043E \u0442\u0430\u0441\u043A\u0430\u043C!')}}function GenerateGroup(){var a=serverStorage.getState().users,b={};for(var f in b.all=[],a){var g=replacer(f,!1),h=g.split('.'),j=h[0];'undefined'==typeof b[j]&&(b[j]=[]),b[j].push(g),b.all.push(g)}adminpanelStorage.dispatch({type:'GEN_GROUP',payload:{groups:b}})}